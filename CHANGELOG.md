# Changelog

Все значимые изменения проекта документируются здесь.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

## 2026-02-19 — Поведенческая аналитика студентов

### Добавлено
- Реализована система трекинга поведенческих событий студентов (`useAnalytics` хук)
- Создан API-эндпоинт `/api/track` для записи аналитических событий
- Добавлен бэкенд-модуль `api/_lib/admin/analytics.ts` — агрегация и фильтрация аналитики для админов
- Создана страница `AdminAnalytics` с графиками активности, популярным контентом и воронкой вовлечённости
- Добавлена миграция `010-analytics-events` — таблица с 4 индексами для быстрых выборок
- Интегрирован трекинг в ключевые страницы: AI-ассистент, промпты, стили, инструменты

### Исправлено
- Исправлен баг в скрипте миграции — `process.exit(1)` вызывался немедленно вместо передачи как callback

## 2026-02-18 — Исправлена видимость виджета созвонов

### Исправлено
- Исправлена ошибка TS2304: переменная `tokenData` вынесена из try-блока для доступа в catch (логирование ошибок)
- Исправлена проблема с отображением виджета «Следующий созвон» для студентов — некорректная фильтрация по когорте
- Подключена карточка созвонов на AdminDashboard к реальному API вместо заглушки
- Исправлена видимость созвонов с учётом глобального доступа по когортам и кросс-доступа через `cohort_call_access`

### Изменено
- Расширен SQL-запрос в `api/calls/upcoming.ts` — добавлена поддержка глобальных созвонов (`cohort_id IS NULL`) и превью для админов
- Обновлён `AdminDashboard` — карточка созвонов отображает реальные данные из API
- Обновлён `AdminCalls` — улучшена логика фильтрации и отображения
