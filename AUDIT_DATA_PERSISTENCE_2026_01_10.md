# –û—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (Data Persistence Audit)
**–î–∞—Ç–∞:** 10 —è–Ω–≤–∞—Ä—è 2026 –≥.
**–°—Ç–∞—Ç—É—Å:** –ê—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω
**–†–æ–ª—å:** Senior Full-Stack Architect & Security Auditor

–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ (Frontend) –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL), –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏.

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã VIBES –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç ‚Äî **"Hybrid State Schizophrenia"**. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–æ–≥—Ä–µ—Å—Å, –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞) —É–∂–µ –∏–º–µ—é—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î, –Ω–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ –∏–Ω–µ—Ä—Ü–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `localStorage` –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

## 1. –ù–∞–π–¥–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ Browser Cache (LocalStorage)
–í –∫–æ–¥–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ 11 –∫–ª—é—á–µ–π `localStorage`. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞.

| –≠–ª–µ–º–µ–Ω—Ç (Key) | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –ì–¥–µ –Ω–∞–π–¥–µ–Ω | –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ | –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞? |
| :--- | :--- | :--- | :--- | :--- |
| **`vibes_chat_history`** | JSON (–ú–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π) | `Assistant.tsx` | üî¥ **CRITICAL** | –ò—Å—Ç–æ—Ä–∏—è –æ–±—â–µ–Ω–∏—è —Å AI —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–ª–∏ –æ—á–∏—Å—Ç–∫–µ –∫—ç—à–∞. –¢–∞–±–ª–∏—Ü–∞ `chat_messages` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è *—á—Ç–µ–Ω–∏—è* –∏—Å—Ç–æ—Ä–∏–∏. |
| **`vibes_roadmap_progress`** | JSON (ID –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤) | `Roadmaps.tsx` | üî¥ **CRITICAL** | –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –±—Ä–∞—É–∑–µ—Ä—É, –∞ –Ω–µ –∫ –∞–∫–∫–∞—É–Ω—Ç—É. –¢–∞–±–ª–∏—Ü—ã `user_roadmap_progress` –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç. |
| **`vibes_onboarded_{userId}`** | Boolean (Flag) | `App.tsx` | üü† **HIGH** | –§–ª–∞–≥ "–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ". –î—É–±–ª–∏—Ä—É–µ—Ç –ø–æ–ª–µ `users.onboarding_completed`. –ï—Å–ª–∏ —é–∑–µ—Ä –∑–∞–π–¥–µ—Ç —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –µ–º—É —Å–Ω–æ–≤–∞ –ø–æ–∫–∞–∂—É—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥. |
| **`vibes_invites`** | JSON (–ö—ç—à) | `App.tsx` | üü° **MEDIUM** | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–Ω–≤–∞–π—Ç–æ–≤. –ò–∑–±—ã—Ç–æ—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –µ—Å—Ç—å –±—ã—Å—Ç—Ä—ã–π API. –ú–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ. |
| **`vibes_sound_enabled`** / `_volume` | Boolean / Number | `SoundContext.tsx` | üü¢ **LOW** | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞. –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –ø—Ä–∏—è—Ç–Ω–æ –∏–º–µ—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏. |
| **`theme`** | String ('dark'/'light') | `App.tsx` | üü¢ **LOW** | –¢–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–≤—É–∫—É. |

## 2. –≠–ª–µ–º–µ–Ω—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –ë–∞–∑—É –î–∞–Ω–Ω—ã—Ö

–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö "—Å–∏—Ä–æ—Ç" –≤ `localStorage` —Å —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–æ–π `schema.sql`.

| –î–∞–Ω–Ω—ã–µ –∏–∑ LocalStorage | –¢–∞–±–ª–∏—Ü–∞ –≤ –ë–î (–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è) | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ |
| :--- | :--- | :--- |
| `vibes_chat_history` | **`chat_messages`** | **Frontend:** –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `Assistant.tsx`. –ü—Ä–∏ –º–∞—É–Ω—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–µ–ª–∞—Ç—å `GET /api/chat/history`. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î, –∞ –Ω–µ –≤ `localStorage`. |
| `vibes_roadmap_progress` | **`user_roadmap_step_progress`** | **Frontend:** –í `Roadmaps.tsx` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useEffect` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑ API. –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–ª–∏—è–Ω–∏—è —Å `localStorage`. |
| `vibes_onboarded_*` | **`users.onboarding_completed`** | **API:** –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ —Å–ª–∞—Ç—å `POST /api/users/complete-onboarding`. **Frontend:** –ë—Ä–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ `user` –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –∞ –Ω–µ –∏–∑ –∫–ª—é—á–∞. |
| `vibes_sound_*` / `theme` | *–ù–µ—Ç (–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞)* | **DB:** –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `preferences JSONB DEFAULT '{}'` –≤ —Ç–∞–±–ª–∏—Ü—É `users`. –•—Ä–∞–Ω–∏—Ç—å —Ç–∞–º `{ sound: boolean, volume: number, theme: string }`. |

## 3. –ê–Ω–∞–ª–∏–∑ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –∏ –ì–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:**
*   –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`AdminSettings.tsx`) —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
*   –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (`navConfig`) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ API –≤ —Ç–∞–±–ª–∏—Ü—É `platform_settings` (–∫–ª—é—á `navigation`). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –∞–¥–º–∏–Ω –æ—Ç–∫–ª—é—á–∏—Ç —Ä–∞–∑–¥–µ–ª "–î–∞—à–±–æ—Ä–¥", –æ–Ω –ø—Ä–æ–ø–∞–¥–µ—Ç —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ó–¥–µ—Å—å `localStorage` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —á—Ç–æ –≤–µ—Ä–Ω–æ.

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã:**
*   –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ —Ç–æ—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `localStorage` (Roadmap). –ê–¥–º–∏–Ω–∫–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 0% –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, —Ö–æ—Ç—è —Å—Ç—É–¥–µ–Ω—Ç –º–æ–≥ –ø—Ä–æ–π—Ç–∏ –ø–æ–ª–æ–≤–∏–Ω—É –∫—É—Ä—Å–∞ –ª–æ–∫–∞–ª—å–Ω–æ.

## 4. –†–µ–∑—é–º–µ –∏ Plan of Action

–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ—Ç MVP (local-first) –∫ Production (server-first).

**–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π):**

1.  **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ü—Ä–æ–≥—Ä–µ—Å—Å–∞ (Roadmaps):**
    *   –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/progress` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤.
    *   –í `Roadmaps.tsx` –∑–∞–º–µ–Ω–∏—Ç—å —á—Ç–µ–Ω–∏–µ `localStorage` –Ω–∞ API-–∑–∞–ø—Ä–æ—Å.

2.  **–ú–∏–≥—Ä–∞—Ü–∏—è –ò—Å—Ç–æ—Ä–∏–∏ –ß–∞—Ç–∞:**
    *   –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `POST /api/chat` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ `chat_messages`.
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞.

3.  **–û—á–∏—Å—Ç–∫–∞ `App.tsx`:**
    *   –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `vibes_onboarded_...`.
    *   –ü–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª–µ `user.onboarding_completed` –ø—Ä–∏—Ö–æ–¥—è—â–µ–µ —Å `/api/auth/me`.

4.  **Feature: User Preferences (Optional):**
    *   `ALTER TABLE users ADD COLUMN preferences JSONB DEFAULT '{}'::jsonb;`
    *   –°–æ–∑–¥–∞—Ç—å API –¥–ª—è –ø–∞—Ç—á–∏–Ω–≥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫.
